<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä»€ä¹ˆæ˜¯ Virtual DOM | é¢è¯•æŒ‡å—</title>
    <meta name="description" content="å‰ç«¯é¢è¯•æŒ‡å—ï¼Œå‰ç«¯é¢è¯•é¢˜æ•´ç†ï¼ŒæŒ‰æ¨¡å—åˆ†ç±»æ•´ç†æ€»ç»“ï¼Œæ‰“é€ æœ€å…¨é¢çš„å‰ç«¯é¢è¯•é¢˜">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">

    <link rel="preload" href="/assets/css/0.styles.9ad7bc48.css" as="style"><link rel="preload" href="/assets/js/app.f60bfc34.js" as="script"><link rel="preload" href="/assets/js/6.7f8a8777.js" as="script"><link rel="preload" href="/assets/js/3.9d86cf58.js" as="script"><link rel="preload" href="/assets/js/86.29b0f2d4.js" as="script"><link rel="preload" href="/assets/js/11.fb060006.js" as="script"><link rel="prefetch" href="/assets/js/1.9e1b498f.js"><link rel="prefetch" href="/assets/js/10.fbc04ea9.js"><link rel="prefetch" href="/assets/js/100.c06a0f53.js"><link rel="prefetch" href="/assets/js/101.54402ede.js"><link rel="prefetch" href="/assets/js/102.d3860a7d.js"><link rel="prefetch" href="/assets/js/103.51a83ab2.js"><link rel="prefetch" href="/assets/js/104.4107118f.js"><link rel="prefetch" href="/assets/js/105.aada2418.js"><link rel="prefetch" href="/assets/js/106.4ce7d3b7.js"><link rel="prefetch" href="/assets/js/107.ca87a327.js"><link rel="prefetch" href="/assets/js/108.df939701.js"><link rel="prefetch" href="/assets/js/109.9f0c8605.js"><link rel="prefetch" href="/assets/js/110.016c3eb7.js"><link rel="prefetch" href="/assets/js/111.ff5dbcc4.js"><link rel="prefetch" href="/assets/js/112.ab20caec.js"><link rel="prefetch" href="/assets/js/113.6c12e76f.js"><link rel="prefetch" href="/assets/js/114.48e1a019.js"><link rel="prefetch" href="/assets/js/115.f291caf1.js"><link rel="prefetch" href="/assets/js/116.0188d28e.js"><link rel="prefetch" href="/assets/js/117.9b579bae.js"><link rel="prefetch" href="/assets/js/118.89da516f.js"><link rel="prefetch" href="/assets/js/119.c70b5105.js"><link rel="prefetch" href="/assets/js/12.9774db85.js"><link rel="prefetch" href="/assets/js/120.fcf3186f.js"><link rel="prefetch" href="/assets/js/13.ac14541c.js"><link rel="prefetch" href="/assets/js/14.155007f0.js"><link rel="prefetch" href="/assets/js/15.2d9ec2b2.js"><link rel="prefetch" href="/assets/js/16.aec442e8.js"><link rel="prefetch" href="/assets/js/17.59c81a6b.js"><link rel="prefetch" href="/assets/js/18.c38ff446.js"><link rel="prefetch" href="/assets/js/19.8203bd99.js"><link rel="prefetch" href="/assets/js/20.103004c4.js"><link rel="prefetch" href="/assets/js/21.1e6e08c9.js"><link rel="prefetch" href="/assets/js/22.5abbfd40.js"><link rel="prefetch" href="/assets/js/23.4cd5fd4d.js"><link rel="prefetch" href="/assets/js/24.602403ee.js"><link rel="prefetch" href="/assets/js/25.da971f83.js"><link rel="prefetch" href="/assets/js/26.43589785.js"><link rel="prefetch" href="/assets/js/27.6d18f825.js"><link rel="prefetch" href="/assets/js/28.843b905f.js"><link rel="prefetch" href="/assets/js/29.81e33cc0.js"><link rel="prefetch" href="/assets/js/30.7a4491ed.js"><link rel="prefetch" href="/assets/js/31.4275e9d2.js"><link rel="prefetch" href="/assets/js/32.6e6c282b.js"><link rel="prefetch" href="/assets/js/33.35641348.js"><link rel="prefetch" href="/assets/js/34.7737e542.js"><link rel="prefetch" href="/assets/js/35.3d539e4d.js"><link rel="prefetch" href="/assets/js/36.78f70288.js"><link rel="prefetch" href="/assets/js/37.ed0997e2.js"><link rel="prefetch" href="/assets/js/38.6d35141d.js"><link rel="prefetch" href="/assets/js/39.3b4241bb.js"><link rel="prefetch" href="/assets/js/4.cda2fc13.js"><link rel="prefetch" href="/assets/js/40.dd7b6d84.js"><link rel="prefetch" href="/assets/js/41.05fcd6ed.js"><link rel="prefetch" href="/assets/js/42.24fc3ac4.js"><link rel="prefetch" href="/assets/js/43.27b59a40.js"><link rel="prefetch" href="/assets/js/44.ac552dd9.js"><link rel="prefetch" href="/assets/js/45.6b1e07c4.js"><link rel="prefetch" href="/assets/js/46.8bf4b340.js"><link rel="prefetch" href="/assets/js/47.57a13e6c.js"><link rel="prefetch" href="/assets/js/48.8ef881a7.js"><link rel="prefetch" href="/assets/js/49.b76df872.js"><link rel="prefetch" href="/assets/js/5.eb1f29dc.js"><link rel="prefetch" href="/assets/js/50.f04492e5.js"><link rel="prefetch" href="/assets/js/51.e000ebea.js"><link rel="prefetch" href="/assets/js/52.bfbd5e6e.js"><link rel="prefetch" href="/assets/js/53.fc0a60dd.js"><link rel="prefetch" href="/assets/js/54.a798cd42.js"><link rel="prefetch" href="/assets/js/55.5ccb6ae1.js"><link rel="prefetch" href="/assets/js/56.1605b000.js"><link rel="prefetch" href="/assets/js/57.79350f4e.js"><link rel="prefetch" href="/assets/js/58.dcff3859.js"><link rel="prefetch" href="/assets/js/59.a366020b.js"><link rel="prefetch" href="/assets/js/60.2c42a67f.js"><link rel="prefetch" href="/assets/js/61.4d471001.js"><link rel="prefetch" href="/assets/js/62.07f7a685.js"><link rel="prefetch" href="/assets/js/63.3774b497.js"><link rel="prefetch" href="/assets/js/64.d8437f45.js"><link rel="prefetch" href="/assets/js/65.eaf10ccb.js"><link rel="prefetch" href="/assets/js/66.74665605.js"><link rel="prefetch" href="/assets/js/67.072c35ca.js"><link rel="prefetch" href="/assets/js/68.764ab8cb.js"><link rel="prefetch" href="/assets/js/69.6a27592a.js"><link rel="prefetch" href="/assets/js/7.9a5c64fa.js"><link rel="prefetch" href="/assets/js/70.2e7f3527.js"><link rel="prefetch" href="/assets/js/71.c6365fbe.js"><link rel="prefetch" href="/assets/js/72.15cfe1be.js"><link rel="prefetch" href="/assets/js/73.d56ee920.js"><link rel="prefetch" href="/assets/js/74.f848ccac.js"><link rel="prefetch" href="/assets/js/75.905f5556.js"><link rel="prefetch" href="/assets/js/76.49d98a04.js"><link rel="prefetch" href="/assets/js/77.4b62003f.js"><link rel="prefetch" href="/assets/js/78.5a4046ff.js"><link rel="prefetch" href="/assets/js/79.eb3ec067.js"><link rel="prefetch" href="/assets/js/8.bccf8145.js"><link rel="prefetch" href="/assets/js/80.c8247597.js"><link rel="prefetch" href="/assets/js/81.69952221.js"><link rel="prefetch" href="/assets/js/82.4439fbe3.js"><link rel="prefetch" href="/assets/js/83.df1321d3.js"><link rel="prefetch" href="/assets/js/84.23d01b47.js"><link rel="prefetch" href="/assets/js/85.c983047a.js"><link rel="prefetch" href="/assets/js/87.12e2e192.js"><link rel="prefetch" href="/assets/js/88.fb19aa58.js"><link rel="prefetch" href="/assets/js/89.ee2be7d8.js"><link rel="prefetch" href="/assets/js/9.ce1180ae.js"><link rel="prefetch" href="/assets/js/90.479f4d9d.js"><link rel="prefetch" href="/assets/js/91.619e0c8d.js"><link rel="prefetch" href="/assets/js/92.ae858703.js"><link rel="prefetch" href="/assets/js/93.f90a7ae1.js"><link rel="prefetch" href="/assets/js/94.8894adb4.js"><link rel="prefetch" href="/assets/js/95.683396f3.js"><link rel="prefetch" href="/assets/js/96.f65dc164.js"><link rel="prefetch" href="/assets/js/97.75bd77e0.js"><link rel="prefetch" href="/assets/js/98.892b530a.js"><link rel="prefetch" href="/assets/js/99.7d033614.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9ad7bc48.css">
  <script>function hasClass(obj, cls) {
	return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
}

function addClass(obj, cls) {
	if (!this.hasClass(obj, cls)) obj.className += " " + cls;
}

function removeClass(obj, cls) {
	if (hasClass(obj, cls)) {
		var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
		obj.className = obj.className.replace(reg, ' ');
	}
}

function toggleClass(obj,cls){
	if(hasClass(obj,cls)){
		removeClass(obj, cls);
	}else{
		addClass(obj, cls);
	}
}
function openSlider() {
	let node = document.querySelector(".theme-container");
	toggleClass(node, 'sidebar-open')
}
</script>
</head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button" onclick="openSlider()"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active">   </a>  <div class="links" style="max-width: 1309px; background: rgb(255, 255, 255);"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="" class="" placeholder=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div><a href="/docs/base.html" class="nav-link">åŸºç¡€ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/docs/simply.html" class="nav-link">âœ¨è¿›é˜¶ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/excellent-docs/1-HTMLæ¨¡å—.html" class="nav-link">ğŸ”¥ç²¾é€‰ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/docs/handwritten.html" class="nav-link">æ‰‹å†™ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/qa/1-å‰ç«¯100é¢˜è‡ªæ£€.html" class="nav-link">è‡ªæ£€ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/docs/questions.html" class="nav-link">é—®é¢˜ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/interview-exp/å‰ç«¯é¢ç»æ±‡æ€».html" class="nav-link">é¢ç»ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/days/æ¯æ—¥ä¸€é¢˜.html" class="nav-link">æ¯æ—¥ä¸€é¢˜
      </a></div></div><div class="nav-item"><div><a href="/docs/design-pattern.html" class="nav-link router-link-exact-active router-link-active" aria-current="page">è®¾è®¡æ¨¡å¼
      </a></div></div><div class="nav-item"><div><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html" class="nav-link">åŸç†ç¯‡
      </a></div></div><div class="nav-item"><div><a href="/docs/detail-expain.html" class="nav-link">ç»¼åˆ
      </a></div></div><div class="nav-item"><div><a href="/algorithm-interview/note/01-å¿«é€Ÿä¸Šæ‰‹â€”â€”ä»0åˆ°1æŒæ¡ç®—æ³•é¢è¯•éœ€è¦çš„æ•°æ®ç»“æ„ï¼ˆä¸€ï¼‰.html" class="nav-link">ç®—æ³•ç¯‡
      </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        å‰ç«¯åŸºç¡€
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-å¤§å‚ H5 å¼€å‘æ¦‚è¿°.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        ç§»åŠ¨ç«¯
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-æµè§ˆå™¨.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        CSS
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue CLI 3 é¡¹ç›®æ„å»ºåŸºç¡€.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        Vue
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-å‰ç«¯å¼€å‘çš„å››ä¸ªæ—¶ä»£.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        React
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        å‰ç«¯å·¥ç¨‹
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-å¾®å‰ç«¯çš„è¯ç”Ÿ.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        å¾®å‰ç«¯
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-ç¯å¢ƒæ­å»º.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        NodeæŒ‡å—
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        Typesctipt
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-å¦‚ä½•ç³»ç»Ÿé«˜æ•ˆåœ°å­¦ä¹ æ•°æ®ç»“æ„ä¸ç®—æ³•.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        æ•°æ®ç»“æ„ä¸ç®—æ³•
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajaxæ€»ç»“ç¯‡.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        æ—¥å¸¸ç§¯ç´¯
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        åšå®¢æ–‡ç« 
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/css-reference" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
        CSSå¯è§†åŒ–
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->   <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/principle-docs/vue/01-ä»æºç è§£è¯»Vueç”Ÿå‘½å‘¨æœŸ.html" class="sidebar-link">ä»æºç è§£è¯»Vueç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/principle-docs/vue/02-ç»„ä»¶çš„æœ¬è´¨.html" class="sidebar-link">ç»„ä»¶çš„æœ¬è´¨</a></li><li><a href="/principle-docs/vue/03-æœ‰çŠ¶æ€ç»„ä»¶çš„è®¾è®¡.html" class="sidebar-link">æœ‰çŠ¶æ€ç»„ä»¶çš„è®¾è®¡</a></li><li><a href="/principle-docs/vue/04-è®¾è®¡ VNode.html" class="sidebar-link">è®¾è®¡ VNode</a></li><li><a href="/principle-docs/vue/05-è¾…åŠ©åˆ›å»º VNode çš„ h å‡½æ•°.html" class="sidebar-link">è¾…åŠ©åˆ›å»º VNode çš„ h å‡½æ•°</a></li><li><a href="/principle-docs/vue/06-è‡ªå®šä¹‰æ¸²æŸ“å™¨å’Œå¼‚æ­¥æ¸²æŸ“.html" class="sidebar-link">è‡ªå®šä¹‰æ¸²æŸ“å™¨å’Œå¼‚æ­¥æ¸²æŸ“</a></li><li><a href="/principle-docs/vue/07-æ¸²æŸ“å™¨ä¹‹æŒ‚è½½.html" class="sidebar-link">æ¸²æŸ“å™¨ä¹‹æŒ‚è½½</a></li><li><a href="/principle-docs/vue/08-æ¸²æŸ“å™¨çš„æ ¸å¿ƒ Diff ç®—æ³•.html" class="sidebar-link">æ¸²æŸ“å™¨çš„æ ¸å¿ƒ Diff ç®—æ³•</a></li><li><a href="/principle-docs/vue/09-æ¸²æŸ“å™¨ä¹‹patch.html" class="sidebar-link">æ¸²æŸ“å™¨ä¹‹patch</a></li><li><a href="/principle-docs/vue/10-å›¾è§£ Vue å“åº”å¼åŸç†.html" class="sidebar-link">å›¾è§£ Vue å“åº”å¼åŸç†</a></li><li><a href="/principle-docs/vue/11-å›¾è§£ Vue å¼‚æ­¥æ›´æ–°.html" class="sidebar-link">å›¾è§£ Vue å¼‚æ­¥æ›´æ–°</a></li><li><a href="/principle-docs/vue/12-å‰–æ Vue å†…éƒ¨è¿è¡Œæœºåˆ¶.html" class="sidebar-link">å‰–æ Vue å†…éƒ¨è¿è¡Œæœºåˆ¶</a></li><li><a href="/principle-docs/vue/13-vueå“åº”å¼åŸç†æ¨¡æ‹Ÿ.html" class="sidebar-link">vueå“åº”å¼åŸç†æ¨¡æ‹Ÿ</a></li><li><a href="/principle-docs/vue/14-vueçŠ¶æ€ç®¡ç†ä¹‹vuex.html" class="sidebar-link">vueçŠ¶æ€ç®¡ç†ä¹‹vuex</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/principle-docs/react/01-React-routeråŸç†.html" class="sidebar-link">React</a></li><li><a href="/principle-docs/react/02-Dvaæ€»ç»“.html" class="sidebar-link">Dvaæ€»ç»“</a></li><li><a href="/principle-docs/react/03-MobXæ€»ç»“.html" class="sidebar-link">MobXæ€»ç»“</a></li><li><a href="/principle-docs/react/04-æµ…æredux-sagaä¸­é—´ä»¶åŠç”¨æ³•.html" class="sidebar-link">æµ…æredux</a></li><li><a href="/principle-docs/react/05-Reduxä¹‹æµ…æä¸­é—´ä»¶.html" class="sidebar-link">Reduxä¹‹æµ…æä¸­é—´ä»¶</a></li><li><a href="/principle-docs/react/06-Reduxä¹‹æºç åˆ†æ.html" class="sidebar-link">Reduxä¹‹æºç åˆ†æ</a></li><li><a href="/principle-docs/react/07-Reduxä¹‹å¼‚æ­¥ActionåŠæ“ä½œ.html" class="sidebar-link">Reduxä¹‹å¼‚æ­¥ActionåŠæ“ä½œ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/principle-docs/webpack/01-Webpack4æ‰“åŒ…æœºåˆ¶åŸç†è§£æ.html" class="sidebar-link">Webpack4æ‰“åŒ…æœºåˆ¶åŸç†è§£æ</a></li><li><a href="/principle-docs/webpack/02-webpackä¸­çš„HMRçƒ­æ›´æ–°åŸç†å‰–æ.html" class="sidebar-link">webpackä¸­çš„HMRçƒ­æ›´æ–°åŸç†å‰–æ</a></li><li><a href="/principle-docs/webpack/03-ä»æºç çª¥æ¢Webpack4.xåŸç†.html" class="sidebar-link">ä»æºç çª¥æ¢Webpack4.xåŸç†</a></li><li><a href="/principle-docs/webpack/04-å®ç°webpackå°å‹æ‰“åŒ…å·¥å…·.html" class="sidebar-link">å®ç°webpackå°å‹æ‰“åŒ…å·¥å…·</a></li><li><a href="/principle-docs/webpack/05-BabelåŸç†åŠå…¶ä½¿ç”¨.html" class="sidebar-link">BabelåŸç†åŠå…¶ä½¿ç”¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ç»¼åˆ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html" class="active sidebar-link">è™šæ‹ŸDOMåŸç†åˆ†æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#ä»€ä¹ˆæ˜¯-virtual-dom" class="sidebar-link">ä»€ä¹ˆæ˜¯ Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#ä¸ºä»€ä¹ˆä½¿ç”¨-virtual-dom" class="sidebar-link">ä¸ºä»€ä¹ˆä½¿ç”¨ Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#è™šæ‹Ÿ-dom-çš„ä½œç”¨" class="sidebar-link">è™šæ‹Ÿ DOM çš„ä½œç”¨</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#virtual-dom-åº“" class="sidebar-link">Virtual DOM åº“</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#snabbdom-åŸºæœ¬ä½¿ç”¨" class="sidebar-link">Snabbdom åŸºæœ¬ä½¿ç”¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#åˆ›å»ºé¡¹ç›®" class="sidebar-link">åˆ›å»ºé¡¹ç›®</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#åŸºæœ¬ä½¿ç”¨" class="sidebar-link">åŸºæœ¬ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#æ¨¡å—" class="sidebar-link">æ¨¡å—</a></li></ul></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#snabbdom-æºç è§£æ" class="sidebar-link">Snabbdom æºç è§£æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#snabbdom-çš„æ ¸å¿ƒ" class="sidebar-link">Snabbdom çš„æ ¸å¿ƒ</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#h-å‡½æ•°" class="sidebar-link">h å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#vnode" class="sidebar-link">VNode</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#snabbdom" class="sidebar-link">snabbdom</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#init" class="sidebar-link">init</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#patch" class="sidebar-link">patch</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#createelm" class="sidebar-link">createElm</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#patchvnode" class="sidebar-link">patchVnode</a></li><li class="sidebar-sub-header"><a href="/principle-docs/comprehensive/01-è™šæ‹ŸDOMåŸç†åˆ†æ.html#updatechildren" class="sidebar-link">updateChildren</a></li></ul></li></ul></li><li><a href="/principle-docs/comprehensive/02-setTimeoutå®ç°åŸç†å’Œä½¿ç”¨æ³¨æ„.html" class="sidebar-link">setTimeoutå®ç°åŸç†å’Œä½¿ç”¨æ³¨æ„</a></li><li><a href="/principle-docs/comprehensive/03-æµ…æPromiseåŸç†.html" class="sidebar-link">æµ…æPromiseåŸç†</a></li><li><a href="/principle-docs/comprehensive/04-æµè§ˆå™¨æ¸²æŸ“åŸç†.html" class="sidebar-link">æµè§ˆå™¨æ¸²æŸ“åŸç†</a></li><li><a href="/principle-docs/comprehensive/05-å‰ç«¯é¢è¯•ä¹‹MVVMæµ…æ.html" class="sidebar-link">å‰ç«¯é¢è¯•ä¹‹MVVMæµ…æ</a></li><li><a href="/principle-docs/comprehensive/06-å‰ç«¯é¢è¯•ä¹‹ç»„ä»¶åŒ–.html" class="sidebar-link">å‰ç«¯é¢è¯•ä¹‹ç»„ä»¶åŒ–</a></li><li><a href="/principle-docs/comprehensive/07-è™šæ‹ŸDOMï¼ˆä¸€ï¼‰.html" class="sidebar-link">è™šæ‹ŸDOMï¼ˆä¸€ï¼‰</a></li><li><a href="/principle-docs/comprehensive/08-è™šæ‹ŸDOMï¼ˆäºŒï¼‰.html" class="sidebar-link">è™šæ‹ŸDOMï¼ˆäºŒï¼‰</a></li><li><a href="/principle-docs/comprehensive/09-å‰ç«¯æ€§èƒ½ä¹‹Performance.html" class="sidebar-link">å‰ç«¯æ€§èƒ½ä¹‹Performance</a></li></ul></section></li></ul> </aside> <main class="page"> <div id="container" class="theme-default-content"><div class="content__default"><h2 id="ä»€ä¹ˆæ˜¯-virtual-dom"><a href="#ä»€ä¹ˆæ˜¯-virtual-dom" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ Virtual DOM</h2> <ol><li><code>Virtual DOM</code>(è™šæ‹Ÿ DOM)ï¼Œæ˜¯ç”±æ™®é€šçš„ <code>JS</code> å¯¹è±¡æ¥æè¿° <code>DOM</code> å¯¹è±¡ï¼Œå› ä¸ºä¸æ˜¯çœŸå®çš„ <code>DOM</code> å¯¹è±¡ï¼Œæ‰€ä»¥å« <code>Virtual DOM</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  s <span class="token operator">+=</span> key <span class="token operator">+</span> <span class="token string">','</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token comment">// æ‰“å°ç»“æœ align,title,lang,translate,dir,hidden,accessKey,draggable,spellcheck,aut ocapitalize,contentEditable,isContentEditable,inputMode,offsetParent,off setTop,offsetLeft,offsetWidth,offsetHeight,style,innerText,outerText,onc opy,oncut,onpaste,onabort,onblur,oncancel,oncanplay,oncanplaythrough,onc hange,onclick,onclose,oncontextmenu,oncuechange,ondblclick,ondrag,ondrag end,ondragenter,ondragleave,ondragover,ondragstart,ondrop,ondurationchan ge,onemptied,onended,onerror,onfocus,oninput,oninvalid,onkeydown,onkeypr ess,onkeyup,onload,onloadeddata,onloadedmetadata,onloadstart,onmousedown ,onmouseenter,onmouseleave,onmousemove,onmouseout,onmouseover,onmouseup, onmousewheel,onpause,onplay,onplaying,onprogress,onratechange,onreset,on resize,onscroll,onseeked,onseeking,onselect,onstalled,onsubmit,onsuspend ,ontimeupdate,ontoggle,onvolumechange,onwaiting,onwheel,onauxclick,ongot pointercapture,onlostpointercapture,onpointerdown,onpointermove,onpointe rup,onpointercancel,onpointerover,onpointerout,onpointerenter,onpointerl eave,onselectstart,onselectionchange,onanimationend,onanimationiteration ,onanimationstart,ontransitionend,dataset,nonce,autofocus,tabIndex,click ,focus,blur,enterKeyHint,onformdata,onpointerrawupdate,attachInternals,n amespaceURI,prefix,localName,tagName,id,className,classList,slot,part,at tributes,shadowRoot,assignedSlot,innerHTML,outerHTML,scrollTop,scrollLef t,scrollWidth,scrollHeight,clientTop,clientLeft,clientWidth,clientHeight ,attributeStyleMap,onbeforecopy,onbeforecut,onbeforepaste,onsearch,eleme ntTiming,previousElementSibling,nextElementSibling,children,firstElement Child,lastElementChild,childElementCount,onfullscreenchange,onfullscreen error,onwebkitfullscreenchange,onwebkitfullscreenerror,setPointerCapture ,releasePointerCapture,hasPointerCapture,hasAttributes,getAttributeNames ,getAttribute,getAttributeNS,setAttribute,setAttributeNS,removeAttribute ,removeAttributeNS,hasAttribute,hasAttributeNS,toggleAttribute,getAttrib uteNode,getAttributeNodeNS,setAttributeNode,setAttributeNodeNS,removeAtt ributeNode,closest,matches,webkitMatchesSelector,attachShadow,getElement sByTagName,getElementsByTagNameNS,getElementsByClassName,insertAdjacentE lement,insertAdjacentText,insertAdjacentHTML,requestPointerLock,getClien tRects,getBoundingClientRect,scrollIntoView,scroll,scrollTo,scrollBy,scr ollIntoViewIfNeeded,animate,computedStyleMap,before,after,replaceWith,re move,prepend,append,querySelector,querySelectorAll,requestFullscreen,web kitRequestFullScreen,webkitRequestFullscreen,createShadowRoot,getDestina tionInsertionPoints,ELEMENT_NODE,ATTRIBUTE_NODE,TEXT_NODE,CDATA_SECTION_ NODE,ENTITY_REFERENCE_NODE,ENTITY_NODE,PROCESSING_INSTRUCTION_NODE,COMME NT_NODE,DOCUMENT_NODE,DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT_NODE,NOTATION _NODE,DOCUMENT_POSITION_DISCONNECTED,DOCUMENT_POSITION_PRECEDING,DOCUMEN T_POSITION_FOLLOWING,DOCUMENT_POSITION_CONTAINS,DOCUMENT_POSITION_CONTAI NED_BY,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC,nodeType,nodeName,baseU RI,isConnected,ownerDocument,parentNode,parentElement,childNodes,firstCh ild,lastChild,previousSibling,nextSibling,nodeValue,textContent,hasChild Nodes,getRootNode,normalize,cloneNode,isEqualNode,isSameNode,compareDocu mentPosition,contains,lookupPrefix,lookupNamespaceURI,isDefaultNamespace ,insertBefore,appendChild,replaceChild,removeChild,addEventListener,remo veEventListener,dispatchEvent</span>
</code></pre></div><ol start="2"><li>å¯ä»¥ä½¿ç”¨ <code>Virtual DOM</code> æ¥æè¿°çœŸå® <code>DOM</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  sel<span class="token punctuation">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  text<span class="token punctuation">:</span> <span class="token string">&quot;Hello Virtual DOM&quot;</span><span class="token punctuation">,</span>
  elm<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-virtual-dom"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-virtual-dom" class="header-anchor">#</a> ä¸ºä»€ä¹ˆä½¿ç”¨ Virtual DOM</h2> <ul><li>æ‰‹åŠ¨æ“ä½œ <code>DOM</code> æ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜éœ€è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼Œè™½ç„¶æœ‰ <code>jQuery</code> ç­‰åº“ç®€åŒ– <code>DOM</code> æ“ä½œï¼Œä½†æ˜¯éšç€é¡¹ç›®çš„å¤æ‚ DOM æ“ä½œå¤æ‚æå‡</li> <li>ä¸ºäº†ç®€åŒ– <code>DOM</code> çš„å¤æ‚æ“ä½œäºæ˜¯å‡ºç°äº†å„ç§ <code>MVVM</code> æ¡†æ¶ï¼Œ<code>MVVM</code> æ¡†æ¶è§£å†³äº†è§†å›¾å’ŒçŠ¶æ€çš„åŒæ­¥é—®é¢˜</li> <li>ä¸ºäº†ç®€åŒ–è§†å›¾çš„æ“ä½œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼Œä½†æ˜¯æ¨¡æ¿å¼•æ“æ²¡æœ‰è§£å†³è·Ÿè¸ªçŠ¶æ€å˜åŒ–çš„é—®é¢˜ï¼Œäºæ˜¯<code>Virtual DOM</code> å‡ºç°äº†</li> <li><code>Virtual DOM</code> çš„å¥½å¤„æ˜¯å½“çŠ¶æ€æ”¹å˜æ—¶ä¸éœ€è¦ç«‹å³æ›´æ–° DOMï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ ‘æ¥æè¿°<code>DOM</code>ï¼Œ<code>Virtual DOM</code> å†…éƒ¨å°†å¼„æ¸…æ¥šå¦‚ä½•æœ‰æ•ˆ(<code>diff</code>)çš„æ›´æ–° <code>DOM</code></li> <li>è™šæ‹Ÿ <code>DOM</code> å¯ä»¥ç»´æŠ¤ç¨‹åºçš„çŠ¶æ€ï¼Œè·Ÿè¸ªä¸Šä¸€æ¬¡çš„çŠ¶æ€</li> <li>é€šè¿‡æ¯”è¾ƒå‰åä¸¤æ¬¡çŠ¶æ€çš„å·®å¼‚æ›´æ–°çœŸå® <code>DOM</code></li></ul> <h2 id="è™šæ‹Ÿ-dom-çš„ä½œç”¨"><a href="#è™šæ‹Ÿ-dom-çš„ä½œç”¨" class="header-anchor">#</a> è™šæ‹Ÿ DOM çš„ä½œç”¨</h2> <ul><li>ç»´æŠ¤è§†å›¾å’ŒçŠ¶æ€çš„å…³ç³»</li> <li>å¤æ‚è§†å›¾æƒ…å†µä¸‹æå‡æ¸²æŸ“æ€§èƒ½</li> <li>é™¤äº†æ¸²æŸ“ <code>DOM</code> ä»¥å¤–ï¼Œè¿˜å¯ä»¥å®ç° <code>SSR(Nuxt.js/Next.js)</code>ã€åŸç”Ÿåº”ç”¨(<code>Weex/React Native</code>)ã€å°ç¨‹åº(<code>mpvue/uni-app</code>)ç­‰</li></ul> <p><img src="http://img-repo.poetries.top/images/20210328112610.png" alt=""></p> <h2 id="virtual-dom-åº“"><a href="#virtual-dom-åº“" class="header-anchor">#</a> Virtual DOM åº“</h2> <ul><li><a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener noreferrer">Snabbdom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li><code>Vue 2.x</code> å†…éƒ¨ä½¿ç”¨çš„ <code>Virtual DOM</code> å°±æ˜¯æ”¹é€ çš„ <code>Snabbdom</code></li> <li>é€šè¿‡æ¨¡å—å¯æ‰©å±•</li> <li>æºç ä½¿ç”¨ <code>TypeScript</code> å¼€å‘</li> <li>æœ€å¿«çš„ <code>Virtual DOM</code> ä¹‹ä¸€</li></ul></li> <li><a href="https://github.com/Matt-Esch/virtual-dom" target="_blank" rel="noopener noreferrer">virtual-dom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="snabbdom-åŸºæœ¬ä½¿ç”¨"><a href="#snabbdom-åŸºæœ¬ä½¿ç”¨" class="header-anchor">#</a> Snabbdom åŸºæœ¬ä½¿ç”¨</h2> <h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="header-anchor">#</a> åˆ›å»ºé¡¹ç›®</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºé¡¹ç›®ç›®å½•</span>
md snabbdom-demo
<span class="token comment"># è¿›å…¥é¡¹ç›®ç›®å½•</span>
<span class="token builtin class-name">cd</span> snabbdom-demo
<span class="token comment"># åˆ›å»º package.json yarn init -y</span>
<span class="token comment"># æœ¬åœ°å®‰è£… parcel</span>
<span class="token function">yarn</span> <span class="token function">add</span> parcel-bundler
</code></pre></div><p>é…ç½® <code>package.json</code> çš„ <code>scripts</code></p> <div class="language- extra-class"><pre class="language-text"><code>&quot;scripts&quot;: {
&quot;dev&quot;: &quot;parcel index.html --open&quot;, &quot;build&quot;: &quot;parcel build index.html&quot;
}
</code></pre></div><p>åˆ›å»ºç›®å½•ç»“æ„</p> <p><img src="http://img-repo.poetries.top/images/20210328123653.png" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>yarn add snabbdom
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>import{init,h,thunk}from'snabbdom'
</code></pre></div><blockquote><p><code>snabbdom</code> çš„æ ¸å¿ƒä»…æä¾›æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œåªå¯¼å‡ºäº†ä¸‰ä¸ªå‡½æ•° <code>init()</code>ã€<code>h()</code>ã€<code>thunk()</code></p></blockquote> <ul><li><code>init()</code> æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œè¿”å› <code>patch()</code></li> <li><code>h()</code> è¿”å›è™šæ‹ŸèŠ‚ç‚¹ <code>VNode</code>ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>Vue.js</code> çš„æ—¶å€™è§è¿‡</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>thunk()</code> æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥åœ¨å¤„ç†ä¸å¯å˜æ•°æ®æ—¶ä½¿ç”¨</li></ul> <blockquote><p>æ³¨æ„:å¯¼å…¥æ—¶å€™ä¸èƒ½ä½¿ç”¨ <code>import snabbdom from 'snabbdom'</code>ã€‚åŸå› :<code>node_modules/src/snabbdom.ts</code> æœ«å°¾å¯¼å‡ºä½¿ç”¨çš„è¯­æ³•æ˜¯ <code>export</code> å¯¼å‡º <code>API</code>ï¼Œæ²¡æœ‰ä½¿ç”¨ <code>export default</code> å¯¼å‡ºé»˜è®¤è¾“å‡º</p></blockquote> <p><img src="http://img-repo.poetries.top/images/20210328124133.png" alt=""></p> <h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="header-anchor">#</a> åŸºæœ¬ä½¿ç”¨</h3> <p><strong>ä¾‹å­1</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token comment">// 1. hello world</span>
<span class="token comment">// å‚æ•°ï¼šæ•°ç»„ï¼Œæ¨¡å—</span>
<span class="token comment">// è¿”å›å€¼ï¼špatchå‡½æ•°ï¼Œä½œç”¨å¯¹æ¯”ä¸¤ä¸ªvnodeçš„å·®å¼‚æ›´æ–°åˆ°çœŸå®DOM</span>
<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ ‡ç­¾+é€‰æ‹©å™¨</span>
<span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šå¦‚æœæ˜¯å­—ç¬¦ä¸²çš„è¯å°±æ˜¯æ ‡ç­¾ä¸­çš„å†…å®¹</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container.cls'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  hook<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">init</span> <span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">create</span> <span class="token punctuation">(</span><span class="token parameter">emptyVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå¯ä»¥æ˜¯DOMå…ƒç´ ï¼Œå†…éƒ¨ä¼šæŠŠDOMå…ƒç´ è½¬æ¢æˆVNode</span>
<span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šVNode</span>
<span class="token comment">// è¿”å›å€¼ï¼šVNde</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// å‡è®¾çš„æ—¶åˆ»</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span>

<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¾‹å­2</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2. divä¸­æ”¾ç½®å­å…ƒç´  h1,p</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'è¿™æ˜¯ä¸€ä¸ªpæ ‡ç­¾'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'Hello P'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

  <span class="token comment">// æ¸…ç©ºé¡µé¢å…ƒç´  -- é”™è¯¯</span>
  <span class="token comment">// patch(oldVnode, null)</span>
  <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ä¾‹å­3 debug-patchVnode</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// patchVnode çš„æ‰§è¡Œè¿‡ç¨‹</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¾‹å­4 debug-updateChildren</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// updateChildren çš„æ‰§è¡Œè¿‡ç¨‹</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¾‹å­5 debug-updateChildren-key</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'a'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'b'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'c'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// updateChildren çš„æ‰§è¡Œè¿‡ç¨‹</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'a'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'c'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'b'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><h3 id="æ¨¡å—"><a href="#æ¨¡å—" class="header-anchor">#</a> æ¨¡å—</h3> <blockquote><p><code>Snabbdom</code> çš„æ ¸å¿ƒåº“å¹¶ä¸èƒ½å¤„ç†å…ƒç´ çš„<code>å±æ€§/æ ·å¼/äº‹ä»¶</code>ç­‰ï¼Œå¦‚æœéœ€è¦å¤„ç†çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å—</p></blockquote> <p><strong>å¸¸ç”¨æ¨¡å—</strong></p> <p>å®˜æ–¹æä¾›äº† 6 ä¸ªæ¨¡å—</p> <ul><li><code>attributes</code> <ul><li>è®¾ç½® <code>DOM</code> å…ƒç´ çš„å±æ€§ï¼Œä½¿ç”¨ <code>setAttribute ()</code></li> <li>å¤„ç†å¸ƒå°”ç±»å‹çš„å±æ€§</li></ul></li> <li><code>props</code> <ul><li>å’Œ <code>attributes</code> æ¨¡å—ç›¸ä¼¼ï¼Œè®¾ç½® <code>DOM</code> å…ƒç´ çš„å±æ€§ <code>element[attr] = value</code></li> <li>ä¸å¤„ç†å¸ƒå°”ç±»å‹çš„å±æ€§</li></ul></li> <li><code>class</code> <ul><li>åˆ‡æ¢ç±»æ ·å¼</li> <li>æ³¨æ„:ç»™å…ƒç´ è®¾ç½®ç±»æ ·å¼æ˜¯é€šè¿‡ <code>sel</code> é€‰æ‹©å™¨</li></ul></li> <li><code>dataset</code> <ul><li>è®¾ç½® <code>data-*</code> çš„è‡ªå®šä¹‰å±æ€§ <code>eventlisteners</code></li> <li>æ³¨å†Œå’Œç§»é™¤äº‹ä»¶</li></ul></li> <li><code>style</code> <ul><li>è®¾ç½®è¡Œå†…æ ·å¼ï¼Œæ”¯æŒåŠ¨ç”»</li> <li><code>delayed/remove/destroy</code></li></ul></li></ul> <p><strong>æ¨¡å—ä½¿ç”¨</strong></p> <blockquote><p>æ¨¡å—ä½¿ç”¨æ­¥éª¤:</p></blockquote> <ul><li>å¯¼å…¥éœ€è¦çš„æ¨¡å—</li> <li><code>init()</code> ä¸­æ³¨å†Œæ¨¡å—</li> <li>ä½¿ç”¨ <code>h()</code> å‡½æ•°åˆ›å»º <code>VNode</code> çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºå¯¹è±¡ï¼Œå…¶ä»–å‚æ•°å¾€åç§»</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> init<span class="token punctuation">,</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>
<span class="token comment">// 1. å¯¼å…¥æ¨¡å—</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'snabbdom/modules/style'</span>
<span class="token keyword">import</span> eventlisteners <span class="token keyword">from</span> <span class="token string">'snabbdom/modules/eventlisteners'</span>
<span class="token comment">// 2. æ³¨å†Œæ¨¡å—</span>
<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  style<span class="token punctuation">,</span>
  eventlisteners
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 3. ä½¿ç”¨ h() å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¨¡å—éœ€è¦çš„æ•°æ®ï¼ˆå¯¹è±¡ï¼‰</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  style<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    backgroundColor<span class="token punctuation">:</span> <span class="token string">'red'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  on<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    click<span class="token punctuation">:</span> eventHandler
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'è¿™æ˜¯pæ ‡ç­¾'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">eventHandler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç‚¹å‡»æˆ‘äº†'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>


vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><h2 id="snabbdom-æºç è§£æ"><a href="#snabbdom-æºç è§£æ" class="header-anchor">#</a> Snabbdom æºç è§£æ</h2> <h3 id="snabbdom-çš„æ ¸å¿ƒ"><a href="#snabbdom-çš„æ ¸å¿ƒ" class="header-anchor">#</a> Snabbdom çš„æ ¸å¿ƒ</h3> <ul><li>ä½¿ç”¨ <code>h()</code> å‡½æ•°åˆ›å»º JavaScript å¯¹è±¡(<code>VNode</code>)æè¿°çœŸå® DOM</li> <li><code>init()</code> è®¾ç½®æ¨¡å—ï¼Œåˆ›å»º <code>patch()</code></li> <li><code>patch()</code> æ¯”è¾ƒæ–°æ—§ä¸¤ä¸ª <code>VNode</code></li> <li>æŠŠå˜åŒ–çš„å†…å®¹æ›´æ–°åˆ°çœŸå® <code>DOM</code> æ ‘ä¸Š</li></ul> <p><strong>Snabbdom æºç </strong></p> <blockquote><p>æºç åœ°å€: https://github.com/snabbdom/snabbdom</p></blockquote> <p>src ç›®å½•ç»“æ„</p> <p><img src="http://img-repo.poetries.top/images/20210328125857.png" alt=""></p> <h3 id="h-å‡½æ•°"><a href="#h-å‡½æ•°" class="header-anchor">#</a> h å‡½æ•°</h3> <ul><li><code>h()</code> å‡½æ•°ä»‹ç»: åœ¨ä½¿ç”¨ <code>Vue</code> çš„æ—¶å€™è§è¿‡ <code>h()</code> å‡½æ•°</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>h()</code> å‡½æ•°æœ€æ—©è§äº <code>hyperscript</code>ï¼Œä½¿ç”¨ JavaScript åˆ›å»ºè¶…æ–‡æœ¬</li> <li>Snabbdom ä¸­çš„ <code>h()</code> å‡½æ•°ä¸æ˜¯ç”¨æ¥åˆ›å»ºè¶…æ–‡æœ¬ï¼Œè€Œæ˜¯åˆ›å»º <code>VNode</code></li></ul> <p><strong>å‡½æ•°é‡è½½</strong></p> <ul><li>æ¦‚å¿µ</li> <li>å‚æ•°ä¸ªæ•°æˆ–ç±»å‹ä¸åŒçš„å‡½æ•°</li> <li><code>JavaScript</code> ä¸­æ²¡æœ‰é‡è½½çš„æ¦‚å¿µ</li> <li><code>TypeScript</code> ä¸­æœ‰é‡è½½ï¼Œä¸è¿‡é‡è½½çš„å®ç°è¿˜æ˜¯é€šè¿‡ä»£ç è°ƒæ•´å‚æ•°</li> <li>é‡è½½çš„ç¤ºæ„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æºç ä½ç½®:<code>src/h.ts</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hå‡½æ•°çš„é‡è½½</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">:</span> string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">:</span> string<span class="token punctuation">,</span> data<span class="token punctuation">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">:</span> string<span class="token punctuation">,</span> children<span class="token punctuation">:</span> VNodeChildren</span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">:</span> string<span class="token punctuation">,</span> data<span class="token punctuation">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> VNodeChildren</span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">:</span> any<span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token punctuation">:</span> any<span class="token punctuation">,</span> c<span class="token operator">?</span><span class="token punctuation">:</span> any</span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data<span class="token punctuation">:</span> VNodeData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> children<span class="token punctuation">:</span> any
  <span class="token keyword">let</span> text<span class="token punctuation">:</span> any
  <span class="token keyword">let</span> i<span class="token punctuation">:</span> number
  <span class="token comment">// å¤„ç†å‚æ•°ï¼Œå®ç°é‡è½½çš„æœºåˆ¶</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç†ä¸‰ä¸ªå‚æ•°çš„æƒ…å†µ</span>
    <span class="token comment">// selã€dataã€children/text</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> b
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> c
      <span class="token comment">// å¦‚æœ c æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      text <span class="token operator">=</span> c
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç†ä¸¤ä¸ªå‚æ•°çš„æƒ…å†µ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> b
      <span class="token comment">// å¦‚æœ b æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      text <span class="token operator">=</span> b
      <span class="token comment">// å¦‚æœ b æ˜¯ VNode</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> b <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç† children ä¸­çš„åŸå§‹å€¼(string/number)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœ child æ˜¯ string/numberï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    sel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'s'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'v'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'g'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>sel<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'.'</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ˜¯ svgï¼Œæ·»åŠ å‘½åç©ºé—´</span>
    <span class="token function">addNS</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> sel<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿”å› VNode</span>
  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å¯¼å‡ºæ¨¡å—</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> h<span class="token punctuation">;</span>
</code></pre></div><h3 id="vnode"><a href="#vnode" class="header-anchor">#</a> VNode</h3> <blockquote><p>ä¸€ä¸ª <code>VNode</code> å°±æ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ç”¨æ¥æè¿°ä¸€ä¸ª <code>DOM</code> å…ƒç´ ï¼Œå¦‚æœè¿™ä¸ª <code>VNode</code> æœ‰ <code>children</code> å°±æ˜¯ <code>Virtual DOM</code></p></blockquote> <p>æºç ä½ç½®: <code>src/vnode.ts</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">VNodeData</span> <span class="token punctuation">{</span>
  props<span class="token operator">?</span><span class="token punctuation">:</span> Props
  attrs<span class="token operator">?</span><span class="token punctuation">:</span> Attrs
  <span class="token keyword">class</span><span class="token operator">?</span><span class="token punctuation">:</span> Classes
  style<span class="token operator">?</span><span class="token punctuation">:</span> VNodeStyle
  dataset<span class="token operator">?</span><span class="token punctuation">:</span> Dataset
  on<span class="token operator">?</span><span class="token punctuation">:</span> On
  hero<span class="token operator">?</span><span class="token punctuation">:</span> Hero
  attachData<span class="token operator">?</span><span class="token punctuation">:</span> AttachData
  hook<span class="token operator">?</span><span class="token punctuation">:</span> Hooks
  key<span class="token operator">?</span><span class="token punctuation">:</span> Key
  ns<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token comment">// for SVGs</span>
  fn<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> VNode <span class="token comment">// for thunks</span>
  args<span class="token operator">?</span><span class="token punctuation">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// for thunks</span>
  is<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token comment">// for custom elements v1</span>
  <span class="token punctuation">[</span>key<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> any <span class="token comment">// for any other 3rd party module</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>
  <span class="token comment">// é€‰æ‹©å™¨</span>
  sel<span class="token punctuation">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// èŠ‚ç‚¹æ•°æ®:å±æ€§/æ ·å¼/äº‹ä»¶ç­‰</span>
  data<span class="token punctuation">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// å­èŠ‚ç‚¹ï¼Œå’Œ text åªèƒ½äº’æ–¥</span>
  children<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>VNode <span class="token operator">|</span> string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// è®°å½• vnode å¯¹åº”çš„çœŸå® DOM</span>
  elm<span class="token punctuation">:</span> Node <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// èŠ‚ç‚¹ä¸­çš„å†…å®¹ï¼Œå’Œ children åªèƒ½äº’æ–¥</span>
  text<span class="token punctuation">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// ä¼˜åŒ–ç”¨</span>
  key<span class="token punctuation">:</span> Key <span class="token operator">|</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">vnode</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> any <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>VNode <span class="token operator">|</span> string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  text<span class="token punctuation">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  elm<span class="token punctuation">:</span> Element <span class="token operator">|</span> Text <span class="token operator">|</span> <span class="token keyword">undefined</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> data <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token punctuation">:</span> data<span class="token punctuation">.</span>key
  <span class="token keyword">return</span> <span class="token punctuation">{</span> sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> key <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="snabbdom"><a href="#snabbdom" class="header-anchor">#</a> snabbdom</h3> <ul><li><code>patch(oldVnode, newVnode)</code></li> <li>æ‰“è¡¥ä¸ï¼ŒæŠŠæ–°èŠ‚ç‚¹ä¸­å˜åŒ–çš„å†…å®¹æ¸²æŸ“åˆ°çœŸå® <code>DOM</code>ï¼Œæœ€åè¿”å›æ–°èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€æ¬¡å¤„ç†çš„æ—§èŠ‚ç‚¹</li> <li>å¯¹æ¯”æ–°æ—§ <code>VNode</code> æ˜¯å¦ç›¸åŒèŠ‚ç‚¹(èŠ‚ç‚¹çš„ <code>key</code> å’Œ <code>sel</code> ç›¸åŒ)</li> <li>å¦‚æœä¸æ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œåˆ é™¤ä¹‹å‰çš„å†…å®¹ï¼Œé‡æ–°æ¸²æŸ“</li> <li>å¦‚æœæ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œå†åˆ¤æ–­æ–°çš„ <code>VNode</code> æ˜¯å¦æœ‰ <code>text</code>ï¼Œå¦‚æœæœ‰å¹¶ä¸”å’Œ <code>oldVnode</code> çš„ <code>text</code> ä¸åŒï¼Œç›´æ¥æ›´ æ–°æ–‡æœ¬å†…å®¹</li> <li>å¦‚æœæ–°çš„ <code>VNode</code> æœ‰ <code>children</code>ï¼Œåˆ¤æ–­å­èŠ‚ç‚¹æ˜¯å¦æœ‰å˜åŒ–ï¼Œåˆ¤æ–­å­èŠ‚ç‚¹çš„è¿‡ç¨‹ä½¿ç”¨çš„å°±æ˜¯ <code>diff</code> ç®—æ³•</li> <li><code>diff</code> è¿‡ç¨‹åªè¿›è¡ŒåŒå±‚çº§æ¯”è¾ƒ</li></ul> <p><img src="http://img-repo.poetries.top/images/20210329091820.png" alt=""></p> <h3 id="init"><a href="#init" class="header-anchor">#</a> init</h3> <ul><li>åŠŸèƒ½: <code>init(modules, domApi)</code>ï¼Œè¿”å› <code>patch()</code>å‡½æ•°(é«˜é˜¶å‡½æ•°)</li> <li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é«˜é˜¶å‡½æ•°?
<ul><li>å› ä¸º <code>patch()</code> å‡½æ•°å†å¤–éƒ¨ä¼šè°ƒç”¨å¤šæ¬¡ï¼Œæ¯æ¬¡è°ƒç”¨ä¾èµ–ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚: <code>modules/domApi/cbs</code></li> <li>é€šè¿‡é«˜é˜¶å‡½æ•°è®© <code>init()</code> å†…éƒ¨å½¢æˆé—­åŒ…ï¼Œè¿”å›çš„ <code>patch()</code> å¯ä»¥è®¿é—®åˆ° <code>modules/domApi/cbs</code>ï¼Œè€Œ ä¸éœ€è¦é‡æ–°åˆ›å»º</li></ul></li> <li><code>init()</code> åœ¨è¿”å› <code>patch()</code> ä¹‹å‰ï¼Œé¦–å…ˆæ”¶é›†äº†æ‰€æœ‰æ¨¡å—ä¸­çš„é’©å­å‡½æ•°å­˜å‚¨åˆ° <code>cbs</code> å¯¹è±¡ä¸­</li></ul> <blockquote><p>æºç ä½ç½®:<code>src/init.ts</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span> <span class="token punctuation">(</span><span class="token parameter">modules<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>Module<span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> domApi<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">DOMAPI</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token punctuation">:</span> number
  <span class="token keyword">let</span> j<span class="token punctuation">:</span> number
  <span class="token keyword">const</span> cbs<span class="token punctuation">:</span> ModuleHooks <span class="token operator">=</span> <span class="token punctuation">{</span>
    create<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    update<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    remove<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    destroy<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    pre<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    post<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> api<span class="token punctuation">:</span> <span class="token constant">DOMAPI</span> <span class="token operator">=</span> domApi <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> domApi <span class="token punctuation">:</span> htmlDomApi

  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hook <span class="token operator">=</span> modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hook <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token punctuation">:</span> VNode</span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i<span class="token punctuation">:</span> number<span class="token punctuation">,</span> elm<span class="token punctuation">:</span> Node<span class="token punctuation">,</span> parent<span class="token punctuation">:</span> Node
    <span class="token keyword">const</span> insertedVnodeQueue<span class="token punctuation">:</span> VNodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>
      parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token keyword">as</span> Node

      <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook<span class="token operator">!</span><span class="token punctuation">.</span>insert<span class="token operator">!</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> vnode
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="patch"><a href="#patch" class="header-anchor">#</a> patch</h3> <ul><li>åŠŸèƒ½:
<ul><li>ä¼ å…¥æ–°æ—§ <code>VNode</code>ï¼Œå¯¹æ¯”å·®å¼‚ï¼ŒæŠŠå·®å¼‚æ¸²æŸ“åˆ° <code>DOM</code></li> <li>è¿”å›æ–°çš„ <code>VNode</code>ï¼Œä½œä¸ºä¸‹ä¸€æ¬¡ <code>patch()</code> çš„ <code>oldVnode</code></li></ul></li> <li>æ‰§è¡Œè¿‡ç¨‹:
<ul><li>é¦–å…ˆæ‰§è¡Œæ¨¡å—ä¸­çš„é’©å­å‡½æ•° <code>pre</code></li> <li>å¦‚æœ <code>oldVnode</code> å’Œ <code>vnode</code> ç›¸åŒ(<code>key</code> å’Œ <code>sel</code> ç›¸åŒ)
<ul><li>è°ƒç”¨ <code>patchVnode()</code>ï¼Œæ‰¾èŠ‚ç‚¹çš„å·®å¼‚å¹¶æ›´æ–° <code>DOM</code></li></ul></li> <li>å¦‚æœ <code>oldVnode</code> æ˜¯ <code>DOM</code> å…ƒç´ 
<ul><li>æŠŠ <code>DOM</code> å…ƒç´ è½¬æ¢æˆ <code>oldVnode</code></li> <li>è°ƒç”¨ <code>createElm()</code> æŠŠ <code>vnode</code> è½¬æ¢ä¸ºçœŸå® <code>DOM</code>ï¼Œè®°å½•åˆ° <code>vnode.elm</code></li> <li>æŠŠåˆšåˆ›å»ºçš„ <code>DOM</code> å…ƒç´ æ’å…¥åˆ° <code>parent</code> ä¸­</li> <li>ç§»é™¤è€èŠ‚ç‚¹</li> <li>è§¦å‘ç”¨æˆ·è®¾ç½®çš„ <code>create</code> é’©å­å‡½æ•°</li></ul></li></ul></li></ul> <p>æºç ä½ç½®:<code>src/snabbdom.ts</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token punctuation">:</span> VNode</span><span class="token punctuation">)</span><span class="token punctuation">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token punctuation">:</span> number<span class="token punctuation">,</span> elm<span class="token punctuation">:</span> Node<span class="token punctuation">,</span> parent<span class="token punctuation">:</span> Node
  <span class="token comment">// ä¿å­˜æ–°æ’å…¥èŠ‚ç‚¹çš„é˜Ÿåˆ—ï¼Œä¸ºäº†è§¦å‘é’©å­å‡½æ•°</span>
  <span class="token keyword">const</span> insertedVnodeQueue<span class="token punctuation">:</span> VNodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ pre é’©å­å‡½æ•°</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// å¦‚æœ oldVnode ä¸æ˜¯ VNodeï¼Œåˆ›å»º VNode å¹¶è®¾ç½® elm</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æŠŠ DOM å…ƒç´ è½¬æ¢æˆç©ºçš„ VNode</span>
    oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœæ–°æ—§èŠ‚ç‚¹æ˜¯ç›¸åŒèŠ‚ç‚¹(key å’Œ sel ç›¸åŒ)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰¾èŠ‚ç‚¹çš„å·®å¼‚å¹¶æ›´æ–° DOM</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ–°æ—§èŠ‚ç‚¹ä¸åŒï¼Œvnode åˆ›å»ºå¯¹åº”çš„ DOM</span>
    <span class="token comment">// è·å–å½“å‰çš„ DOM å…ƒç´ </span>
    elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>
    parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token keyword">as</span> Node
    <span class="token comment">// è§¦å‘ init/create é’©å­å‡½æ•°,åˆ›å»º DOM</span>
    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœçˆ¶èŠ‚ç‚¹ä¸ä¸ºç©ºï¼ŒæŠŠ vnode å¯¹åº”çš„ DOM æ’å…¥åˆ°æ–‡æ¡£ä¸­</span>
      api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// ç§»é™¤è€èŠ‚ç‚¹</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ insert é’©å­å‡½æ•° </span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook<span class="token operator">!</span><span class="token punctuation">.</span>insert<span class="token operator">!</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ post é’©å­å‡½æ•°</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// è¿”å› vnode</span>
  <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre></div><h3 id="createelm"><a href="#createelm" class="header-anchor">#</a> createElm</h3> <ul><li><p>åŠŸèƒ½:</p> <ul><li><code>createElm(vnode, insertedVnodeQueue)</code>ï¼Œè¿”å›åˆ›å»ºçš„ <code>DOM</code> å…ƒç´ </li> <li>åˆ›å»º <code>vnode</code> å¯¹åº”çš„ <code>DOM</code> å…ƒç´ </li></ul></li> <li><p>æ‰§è¡Œè¿‡ç¨‹:</p></li> <li><p>é¦–å…ˆè§¦å‘ç”¨æˆ·è®¾ç½®çš„ <code>init</code> é’©å­å‡½æ•°</p></li> <li><p>å¦‚æœé€‰æ‹©å™¨æ˜¯<code>!</code>ï¼Œåˆ›å»ºè¯„è®ºèŠ‚ç‚¹</p></li> <li><p>å¦‚æœé€‰æ‹©å™¨ä¸ºç©ºï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</p></li> <li><p>å¦‚æœé€‰æ‹©å™¨ä¸ä¸ºç©º</p> <ul><li>è§£æé€‰æ‹©å™¨ï¼Œè®¾ç½®æ ‡ç­¾çš„ <code>id</code> å’Œ <code>class</code> å±æ€§</li> <li>æ‰§è¡Œæ¨¡å—çš„ <code>create</code> é’©å­å‡½æ•°</li> <li>å¦‚æœ <code>vnode</code> æœ‰ <code>children</code>ï¼Œåˆ›å»ºå­ <code>vnode</code> å¯¹åº”çš„ <code>DOM</code>ï¼Œè¿½åŠ åˆ° <code>DOM</code> æ ‘</li> <li>å¦‚æœ <code>vnode</code> çš„ <code>text</code> å€¼æ˜¯ <code>string/number</code>ï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹å¹¶è¿½å‡»åˆ° <code>DOM</code> æ ‘</li> <li>æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>create</code> é’©å­å‡½æ•°</li> <li>å¦‚æœæœ‰ç”¨æˆ·è®¾ç½®çš„ <code>insert</code> é’©å­å‡½æ•°ï¼ŒæŠŠ <code>vnode</code> æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">:</span> VNodeQueue</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Node <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token punctuation">:</span> any
  <span class="token keyword">let</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ init é’©å­å‡½æ•°</span>
    <span class="token keyword">const</span> init <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token operator">?</span><span class="token punctuation">.</span>init
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
      data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
  <span class="token keyword">const</span> sel <span class="token operator">=</span> vnode<span class="token punctuation">.</span>sel
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">===</span> <span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœé€‰æ‹©å™¨æ˜¯!ï¼Œåˆ›å»ºè¯„è®ºèŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Parse selector</span>
    <span class="token comment">// å¦‚æœé€‰æ‹©å™¨ä¸ä¸ºç©º</span>
    <span class="token comment">// è§£æé€‰æ‹©å™¨</span>
    <span class="token comment">// Parse selector</span>
    <span class="token keyword">const</span> hashIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> dotIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> hashIdx<span class="token punctuation">)</span>
    <span class="token keyword">const</span> hash <span class="token operator">=</span> hashIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> hashIdx <span class="token punctuation">:</span> sel<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> dot <span class="token operator">=</span> dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> dotIdx <span class="token punctuation">:</span> sel<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> tag <span class="token operator">=</span> hashIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> dotIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> sel
    <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>ns<span class="token punctuation">)</span>
      <span class="token operator">?</span> api<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      <span class="token punctuation">:</span> api<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hash <span class="token operator">&lt;</span> dot<span class="token punctuation">)</span> elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>dot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\./g</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ create é’©å­å‡½æ•°</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token comment">// å¦‚æœ vnode ä¸­æœ‰å­èŠ‚ç‚¹ï¼Œåˆ›å»ºå­ vnode å¯¹åº”çš„ DOM å…ƒç´ å¹¶è¿½åŠ åˆ° DOM æ ‘ä¸Š</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> ch <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          api<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token function">createElm</span><span class="token punctuation">(</span>ch <span class="token keyword">as</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœ vnode çš„ text å€¼æ˜¯ string/numberï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹å¹¶è¿½åŠ åˆ° DOM æ ‘</span>
      api<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„é’©å­ create</span>
      hook<span class="token punctuation">.</span>create<span class="token operator">?</span><span class="token punctuation">.</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>insert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŠŠ vnode æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸ºåç»­æ‰§è¡Œ insert é’©å­åšå‡†å¤‡</span>
        insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœé€‰æ‹©å™¨ä¸ºç©ºï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</span>
    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿”å›æ–°åˆ›å»ºçš„ DOM</span>
  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm
<span class="token punctuation">}</span>
</code></pre></div><h3 id="patchvnode"><a href="#patchvnode" class="header-anchor">#</a> patchVnode</h3> <ul><li>åŠŸèƒ½:
<ul><li><code>patchVnode(oldVnode, vnode, insertedVnodeQueue)</code></li> <li>å¯¹æ¯” <code>oldVnode</code> å’Œ <code>vnode</code> çš„å·®å¼‚ï¼ŒæŠŠå·®å¼‚æ¸²æŸ“åˆ° <code>DOM</code></li></ul></li> <li>æ‰§è¡Œè¿‡ç¨‹:
<ul><li>é¦–å…ˆæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>prepatch</code> é’©å­å‡½æ•°</li> <li>æ‰§è¡Œ <code>create</code> é’©å­å‡½æ•°
<ul><li>é¦–å…ˆæ‰§è¡Œæ¨¡å—çš„ <code>create</code>é’©å­å‡½æ•°</li> <li>ç„¶åæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>create</code> é’©å­å‡½æ•°</li></ul></li> <li>å¦‚æœ <code>vnode.text</code> æœªå®šä¹‰
<ul><li>å¦‚æœ <code>oldVnode.children</code> å’Œ <code>vnode.children</code> éƒ½æœ‰å€¼
<ul><li>è°ƒç”¨ <code>updateChildren()</code></li> <li>ä½¿ç”¨ <code>diff</code> ç®—æ³•å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œæ›´æ–°å­èŠ‚ç‚¹</li></ul></li> <li>å¦‚æœ <code>vnode.children</code> æœ‰å€¼ï¼Œ <code>oldVnode.children</code> æ— å€¼
<ul><li>æ¸…ç©º <code>DOM</code> å…ƒç´ </li> <li>è°ƒç”¨ <code>addVnodes()</code> ï¼Œæ‰¹é‡æ·»åŠ å­èŠ‚ç‚¹</li></ul></li> <li>å¦‚æœ <code>oldVnode.children</code> æœ‰å€¼ï¼Œ <code>vnode.children</code> æ— å€¼
<ul><li>è°ƒç”¨ <code>removeVnodes()</code> ï¼Œæ‰¹é‡ç§»é™¤å­èŠ‚ç‚¹</li></ul></li> <li>å¦‚æœ <code>oldVnode.text</code> æœ‰å€¼
<ul><li>æ¸…ç©º <code>DOM</code> å…ƒç´ çš„å†…å®¹</li></ul></li></ul></li> <li>å¦‚æœè®¾ç½®äº† <code>vnode.text</code> å¹¶ä¸”å’Œå’Œ <code>oldVnode.text</code> ä¸ç­‰
<ul><li>å¦‚æœè€èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œå…¨éƒ¨ç§»é™¤</li> <li>è®¾ç½® <code>DOM</code> å…ƒç´ çš„ <code>textContent</code> ä¸º <code>vnode.text</code></li></ul></li> <li>æœ€åæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>postpatch</code> é’©å­å‡½æ•°</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">:</span> VNode<span class="token punctuation">,</span> vnode<span class="token punctuation">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">:</span> VNodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span>hook
  <span class="token comment">// é¦–å…ˆæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ prepatch é’©å­å‡½æ•°</span>
  hook<span class="token operator">?</span><span class="token punctuation">.</span>prepatch<span class="token operator">?</span><span class="token punctuation">.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
  <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>
  <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// å¦‚æœæ–°è€ vnode ç›¸åŒè¿”å›</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ update é’©å­å‡½æ•°</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token comment">// æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ update é’©å­å‡½æ•°</span>
    vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token operator">?</span><span class="token punctuation">.</span>update<span class="token operator">?</span><span class="token punctuation">.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœ vnode.text æœªå®šä¹‰</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ–°è€èŠ‚ç‚¹éƒ½æœ‰ children</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä½¿ç”¨ diff ç®—æ³•å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œæ›´æ–°å­èŠ‚ç‚¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœæ–°èŠ‚ç‚¹æœ‰ childrenï¼Œè€èŠ‚ç‚¹æ²¡æœ‰ children</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰textï¼Œæ¸…ç©ºdom å…ƒç´ çš„å†…å®¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token comment">// æ‰¹é‡æ·»åŠ å­èŠ‚ç‚¹</span>
      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰childrenï¼Œæ–°èŠ‚ç‚¹æ²¡æœ‰children</span>
      <span class="token comment">// æ‰¹é‡ç§»é™¤å­èŠ‚ç‚¹</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰ textï¼Œæ¸…ç©º DOM å…ƒç´ </span>
      api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰è®¾ç½® vnode.text</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰ childrenï¼Œç§»é™¤</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¾ç½® DOM å…ƒç´ çš„ textContent ä¸º vnode.text</span>
    api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æœ€åæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ postpatch é’©å­å‡½æ•°</span>
  hook<span class="token operator">?</span><span class="token punctuation">.</span>postpatch<span class="token operator">?</span><span class="token punctuation">.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="updatechildren"><a href="#updatechildren" class="header-anchor">#</a> updateChildren</h3> <ul><li>åŠŸèƒ½:
<ul><li><code>diff</code> ç®—æ³•çš„æ ¸å¿ƒï¼Œå¯¹æ¯”æ–°æ—§èŠ‚ç‚¹çš„ <code>children</code>ï¼Œæ›´æ–° <code>DOM</code></li></ul></li> <li>æ‰§è¡Œè¿‡ç¨‹:</li> <li>è¦å¯¹æ¯”ä¸¤æ£µæ ‘çš„å·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥å–ç¬¬ä¸€æ£µæ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¾æ¬¡å’Œç¬¬äºŒè¯¾æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æ¯” è¾ƒï¼Œä½†æ˜¯è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n^3)</code></li> <li>åœ¨ <code>DOM</code> æ“ä½œçš„æ—¶å€™æˆ‘ä»¬å¾ˆå°‘å¾ˆå°‘ä¼šæŠŠä¸€ä¸ªçˆ¶èŠ‚ç‚¹ç§»åŠ¨/æ›´æ–°åˆ°æŸä¸€ä¸ªå­èŠ‚ç‚¹</li> <li>å› æ­¤åªéœ€è¦æ‰¾åŒçº§åˆ«çš„å­èŠ‚ç‚¹ä¾æ¬¡æ¯”è¾ƒï¼Œç„¶åå†æ‰¾ä¸‹ä¸€çº§åˆ«çš„èŠ‚ç‚¹æ¯”è¾ƒï¼Œè¿™æ ·ç®—æ³•çš„æ—¶é—´å¤ æ‚åº¦ä¸º <code>O(n)</code></li></ul> <p><img src="http://img-repo.poetries.top/images/20210329092027.png" alt=""></p> <ul><li>åœ¨è¿›è¡ŒåŒçº§åˆ«èŠ‚ç‚¹æ¯”è¾ƒçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå¯¹æ–°è€èŠ‚ç‚¹æ•°ç»„çš„å¼€å§‹å’Œç»“å°¾èŠ‚ç‚¹è®¾ç½®æ ‡è®°ç´¢å¼•ï¼Œé å†çš„è¿‡ç¨‹ä¸­ç§»åŠ¨ç´¢å¼•</li> <li>åœ¨å¯¹å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹æ¯”è¾ƒçš„æ—¶å€™ï¼Œæ€»å…±æœ‰å››ç§æƒ…å†µ
<ul><li><code>oldStartVnode / newStartVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹)</li> <li><code>oldEndVnode / newEndVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹)</li> <li><code>oldStartVnode / oldEndVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹)</li> <li><code>oldEndVnode / newStartVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹)</li></ul></li></ul> <p><img src="http://img-repo.poetries.top/images/20210329092301.png" alt=""></p> <ul><li>å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹æ¯”è¾ƒï¼Œè¿™ä¸¤ç§æƒ…å†µç±»ä¼¼
<ul><li><code>oldStartVnode / newStartVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹)</li> <li><code>oldEndVnode / newEndVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹)</li></ul></li> <li>å¦‚æœ <code>oldStartVnode</code> å’Œ <code>newStartVnode</code> æ˜¯ <code>sameVnode</code> (<code>key</code> å’Œ <code>sel</code> ç›¸åŒ)
<ul><li>è°ƒç”¨ <code>patchVnode()</code> å¯¹æ¯”å’Œæ›´æ–°èŠ‚ç‚¹</li> <li>æŠŠæ—§å¼€å§‹å’Œæ–°å¼€å§‹ç´¢å¼•å¾€åç§»åŠ¨ <code>oldStartIdx++ / oldEndIdx++</code></li></ul></li></ul> <p><img src="http://img-repo.poetries.top/images/20210329092430.png" alt=""></p> <ul><li><code>oldStartVnode / newEndVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹) ç›¸åŒ
<ul><li>è°ƒç”¨ <code>patchVnode()</code> å¯¹æ¯”å’Œæ›´æ–°èŠ‚ç‚¹</li> <li>æŠŠ <code>oldStartVnode</code> å¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼Œç§»åŠ¨åˆ°å³è¾¹
<ul><li>æ›´æ–°ç´¢å¼•</li></ul></li></ul></li></ul> <p><img src="http://img-repo.poetries.top/images/20210329092820.png" alt=""></p> <ul><li><code>oldEndVnode / newStartVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹) ç›¸åŒ
<ul><li>è°ƒç”¨ <code>patchVnode()</code> å¯¹æ¯”å’Œæ›´æ–°èŠ‚ç‚¹</li> <li>æŠŠ <code>oldEndVnode</code> å¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼Œç§»åŠ¨åˆ°å·¦è¾¹</li> <li>æ›´æ–°ç´¢å¼•</li></ul></li></ul> <p><img src="http://img-repo.poetries.top/images/20210329093025.png" alt=""></p> <ul><li>å¦‚æœä¸æ˜¯ä»¥ä¸Šå››ç§æƒ…å†µ
<ul><li>éå†æ–°èŠ‚ç‚¹ï¼Œä½¿ç”¨ <code>newStartNode</code> çš„ <code>key</code> åœ¨è€èŠ‚ç‚¹æ•°ç»„ä¸­æ‰¾ç›¸åŒèŠ‚ç‚¹</li> <li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¯´æ˜ <code>newStartNode</code> æ˜¯æ–°èŠ‚ç‚¹
<ul><li>åˆ›å»ºæ–°èŠ‚ç‚¹å¯¹åº”çš„ DOM å…ƒç´ ï¼Œæ’å…¥åˆ° DOM æ ‘ä¸­</li></ul></li> <li>å¦‚æœæ‰¾åˆ°äº†
<ul><li>åˆ¤æ–­æ–°èŠ‚ç‚¹å’Œæ‰¾åˆ°çš„è€èŠ‚ç‚¹çš„ <code>sel</code> é€‰æ‹©å™¨æ˜¯å¦ç›¸åŒ</li> <li>å¦‚æœä¸ç›¸åŒï¼Œè¯´æ˜èŠ‚ç‚¹è¢«ä¿®æ”¹äº†
<ul><li>é‡æ–°åˆ›å»ºå¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼Œæ’å…¥åˆ° DOM æ ‘ä¸­</li></ul></li> <li>å¦‚æœç›¸åŒï¼ŒæŠŠ <code>elmToMove</code> å¯¹åº”çš„ DOM å…ƒç´ ï¼Œç§»åŠ¨åˆ°å·¦è¾¹</li></ul></li></ul></li></ul> <p><img src="http://img-repo.poetries.top/images/20210329093137.png" alt=""></p> <ul><li>å¾ªç¯ç»“æŸ
<ul><li>å½“è€èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹å…ˆéå†å®Œ (<code>oldStartIdx &gt; oldEndIdx</code>)ï¼Œå¾ªç¯ç»“æŸ</li> <li>æ–°èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹å…ˆéå†å®Œ (<code>newStartIdx &gt; newEndIdx</code>)ï¼Œå¾ªç¯ç»“æŸ</li></ul></li> <li>å¦‚æœè€èŠ‚ç‚¹çš„æ•°ç»„å…ˆéå†å®Œ(<code>oldStartIdx &gt; oldEndIdx</code>)ï¼Œè¯´æ˜æ–°èŠ‚ç‚¹æœ‰å‰©ä½™ï¼ŒæŠŠå‰©ä½™èŠ‚ç‚¹æ‰¹é‡æ’å…¥åˆ°å³è¾¹</li></ul> <p><img src="http://img-repo.poetries.top/images/20210329093302.png" alt=""></p> <ul><li>å¦‚æœæ–°èŠ‚ç‚¹çš„æ•°ç»„å…ˆéå†å®Œ(<code>newStartIdx &gt; newEndIdx</code>)ï¼Œè¯´æ˜è€èŠ‚ç‚¹æœ‰å‰©ä½™ï¼ŒæŠŠå‰©ä½™èŠ‚ç‚¹æ‰¹ é‡åˆ é™¤</li></ul> <p><img src="http://img-repo.poetries.top/images/20210329093414.png" alt=""></p></div> <!---->  </div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/principle-docs/webpack/05-BabelåŸç†åŠå…¶ä½¿ç”¨.html" class="prev">BabelåŸç†åŠå…¶ä½¿ç”¨</a></span> <span class="next"><a href="/principle-docs/comprehensive/02-setTimeoutå®ç°åŸç†å’Œä½¿ç”¨æ³¨æ„.html">setTimeoutå®ç°åŸç†å’Œä½¿ç”¨æ³¨æ„</a>
      â†’
    </span></p></div>  <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="è¯·å…ˆé˜…è¯»è´­ä¹°åè®®" class="el-dialog el-dialog--center" style="margin-top:15vh;width:30%;"><div class="el-dialog__header"><span class="el-dialog__title">è¯·å…ˆé˜…è¯»è´­ä¹°åè®®</span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button disabled="disabled" type="button" class="el-button el-button--danger is-disabled" style="width:100%;"><!----><!----><span>æˆ‘å·²é˜…è¯»ï¼ˆ8sï¼‰</span></button></span></div></div></div> <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="ä»˜è´¹é˜…è¯»" class="el-dialog" style="margin-top:15vh;width:30%;"><div class="el-dialog__header"><span class="el-dialog__title">ä»˜è´¹é˜…è¯»</span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button disabled="disabled" type="button" class="el-button el-button--danger is-disabled" style="width:100%;"><!----><!----><span>ç¡® å®š</span></button></span></div></div></div> <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="dialog" class="el-dialog" style="margin-top:15vh;width:30%;"><div class="el-dialog__header"><span class="el-dialog__title"></span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><!----></div></div> <img src="data:image/png;base64,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" class="theme-float-btn"></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f60bfc341.js" defer></script><script src="/assets/js/6.7f8a8777.js" defer></script><script src="/assets/js/3.9d86cf58.js" defer></script><script src="/assets/js/86.29b0f2d4.js" defer></script><script src="/assets/js/11.fb060006.js" defer></script>
  </body>
</html>
